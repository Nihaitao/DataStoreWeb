<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>课程-基本信息</title>
    <style>
        .left-side { float: left; width: 18%; min-height: 576px; border: 1px solid #e9edee; background-color: #f6f6f6; }
        .left-sides-title { height: 28px; line-height: 28px; color: #fdfdfd; background-color: #cccccc; text-align: center; font-size: 14px; border-bottom: 1px solid #f6f6f6; cursor: pointer; }
        .subentry { height: 34px; line-height: 34px; /* text-align: center; */ font-size: 14px; color: #666; cursor: pointer; border-top: 1px solid #F6F6F6; padding-left: 38%; }
        li.subentry { position: relative; }
        .left-side li.subentry.active { background-color: #00aaff; color: #fff; }
        .left-side li.subentry.active a { color: #fff; }
        li.subentry span { position: absolute; left: 64px; font-size: 16px; margin-right: 5px; }
        .right-side { float: right; width: 81%; min-height: 576px; border: 1px solid #e9edee; background-color: #f6f6f6; }
        div.u-wrap { width: 98%; }
        .right-side .classes { margin: 0; }
        .u-wrap .mainbackground { position: relative; padding: 50px 100px 10px; background-color: #f6f6f6; }
        .right-side .u-wrap .mainbackground.nopadding { padding: 0 25px; }
        .heading { position: relative; margin: 15px 0; padding: 3px 8px; border-left: 3px solid #fa6900; }
        .right-side .heading { position: relative; }
        .company .heading { border-width: 4px; }
        .right-side div.mainbackground .heading { border-left: 3px solid #0af; height: 18px; font-size: 14px; }
        [v-cloak] { display:none;}
    </style>

</head>
<body id="root">
    <div class="mainContainer">
        <div class="left-side">
            <ul class="menuList_choose">
                <li class="subentry active" data-local="/Html/ResourcesCenter/editSimpleCourse/editClassBaseInfo.html?ID={{ID}}">基本信息</li>
                <li class="subentry" v-cloak v-if="TeachingMethod != 2" data-local="/Html/ResourcesCenter/editSimpleCourse/editClassTypeVideo.html?ID={{ID}}">视频课</li>
                <li class="subentry" data-local="/Html/ResourcesCenter/editSimpleCourse/editCourseDetail.html?ID={{ID}}">课程详情</li>
                <li class="lines"></li>
                <li class="subentry" data-local="/Html/ResourcesCenter/editSimpleCourse/classesResource.html?ID={{ID}}">课程资料</li>
                <li class="subentry" v-cloak v-if="TeachingMethod == 2" data-local="/Html/ResourcesCenter/editSimpleCourse/editliveOrface.html?ID={{ID}}">排课表</li>
            </ul>
        </div>
        <div class="right-side">
            <div class="u-wrap classes">
                <div class="mainbackground nopadding">
                    <blockquote class="layui-elem-quote">
                        基本信息
                    </blockquote>
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">网课名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="Name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" v-model="submitForm.Name">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">学科</label>
                            <div class="layui-input-inline">
                                <remote-sel v-bind:setting="FirstSetting" v-bind:value.sync="linkage.Discipline_OneLevelID" v-bind:change="FirstChange"
                                            initial="off" lay-filter="First" lay-verify="required"></remote-sel>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">二级学科</label>
                            <div class="layui-input-inline">
                                <remote-sel v-bind:setting="SecondSetting" v-bind:value.sync="linkage.Discipline_TwoLevelID" v-bind:change="SecondChange" v-ref:second
                                            initial="off" lay-filter="Second"></remote-sel>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">三级学科</label>
                            <div class="layui-input-inline">
                                <remote-sel v-bind:setting="ThreeSetting" v-bind:value.sync="linkage.Discipline_ThreeLevelID" v-ref:three
                                            initial="off" lay-filter="Three"></remote-sel>

                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">价格</label>
                                <div class="layui-input-block">
                                    <input type="text" name="Price" lay-verify="number" placeholder="请输入" autocomplete="off" class="layui-input" v-model="submitForm.Price">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">优惠价</label>
                                <div class="layui-input-block">
                                    <input type="text" name="PreferentialPrice" lay-verify="number" placeholder="请输入" autocomplete="off" class="layui-input" v-model="submitForm.PreferentialPrice">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">购买基数</label>
                                <div class="layui-input-block">
                                    <input type="text" name="BuyBase" lay-verify="number" placeholder="请输入" autocomplete="off" class="layui-input" v-model="submitForm.BuyBase">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">总课时 </label>
                                <div class="layui-input-block">
                                    <input type="text" name="TotalHours" lay-verify="number" placeholder="请输入" autocomplete="off" class="layui-input" v-model="submitForm.TotalHours">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">是否上架</label>
                                <div class="layui-input-block">
                                    <remote-rad name="IsPutaway" v-bind:setting="IsPutawaySetting" v-bind:value.sync="submitForm.IsPutaway"
                                                initial="off"></remote-rad>
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item" style="text-align:center;">
                            <div class="layui-input-block">
                                <button class="layui-btn" @click="save">保存</button>
                                <button class="layui-btn layui-btn-primary">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<link href="//bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/layer/css/layui.css" rel="stylesheet" />
<script src="//bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/vue/vue.min.js"></script>
<script src="//bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/layer/layui.js"></script>
<script src="//bbsresources.oss-cn-hangzhou.aliyuncs.com/js/require_config.js"></script>
<script src="https://cdn.bootcss.com/jquery/1.10.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.js"></script>
<script src="../Classroom/Sortable.js?v1.0.1"></script>
<script src="https://bbsresources.oss-cn-hangzhou.aliyuncs.com/js/Controls/Common.js"></script>
<script>
    require_js_file(['table', 'form', 'jquery', 'tableExt', 'laydate'],
        function (fnr) {
            var table = layui.table;
            var form = layui.form;
            var tableExt = layui.tableExt;
            var $ = layui.$;

            //搜索条件
            var rootApp = new Vue({
                el: '#root',
                data: {
                    ID: '',
                    TeachingMethod:'',
                    IsPutawaySetting: {
                        tags: { name: "IsPutaway" },
                        options: [
                            { key: "1", value: "上架" },
                            { key: "0", value: "下架" },
                        ],
                        fields: { key: 'key', value: 'value' }
                    },
                    submitForm: {
                        ID: 0,
                        Name: '',
                        Discipline_ID: '',
                        Price: '',
                        PreferentialPrice: '',
                        BuyBase: '',
                        TotalHours: '',
                        TeachingMethod: '',
                        IsPutaway: 1,
                    },
                    linkage: {
                        Discipline_OneLevelID: '',
                        Discipline_TwoLevelID: '',
                        Discipline_ThreeLevelID: '',
                    },
                    FirstSetting: { //联动
                        search: true,
                        options: [
                        ],
                        remote: {
                            url: '/service/Discipline/GetDisciplineWithCID',
                            data: { CID: 0 }
                        },
                        fields: { root: 'ReturnData.Data', key: 'ID', value: 'Name' }
                    },
                    SecondSetting: {
                        options: [],
                        remote: {
                            url: '',
                            data: {}
                        },
                        fields: { root: 'ReturnData.Data', key: 'ID', value: 'Name' }
                    },
                    ThreeSetting: {
                        options: [],
                        remote: {
                            url: '',
                            data: {}
                        },
                        fields: { root: 'ReturnData.Data', key: 'ID', value: 'Name' }
                    },
                },
                watch: {
                    linkage: {
                        handler: function (newVal, oldVal) {
                            if (newVal.Discipline_ThreeLevelID == '') {
                                if (newVal.Discipline_TwoLevelID == '') {
                                    this.submitForm.Discipline_ID = this.linkage.Discipline_OneLevelID;
                                } else {
                                    this.submitForm.Discipline_ID = this.linkage.Discipline_TwoLevelID;
                                }
                            } else {
                                this.submitForm.Discipline_ID = this.linkage.Discipline_ThreeLevelID;
                            }
                        },
                        deep: true
                    },
                },
                ready: function () {
                    if (GetQueryString("ID")) {
                        this.ID = ID = GetQueryString("ID");
                        this.GetCourseByID({ID:ID})
                    }
                    $(".menuList_choose").on('click', 'li.subentry', function () {
                        var href = $(this).attr("data-local");
                        window.location.href = href;
                    });
                },
                methods: {
                    //根据id查询网课
                    GetCourseByID: function (params) {
                        var self = this;
                        $.get("/service/WebCourse/GetCourseByID", params, function (res) {
                            if (res.SuccessResponse) {
                                //双向绑定赋值
                                self.TeachingMethod = res.ReturnData.Data.TeachingMethod;
                                self.submitForm.ID = res.ReturnData.Data.ID;
                                self.submitForm.Name = res.ReturnData.Data.Name;
                                self.submitForm.Discipline_ID = res.ReturnData.Data.Discipline_ID;
                                self.submitForm.Price = res.ReturnData.Data.Price;
                                self.submitForm.PreferentialPricePreferentialPrice = res.ReturnData.Data.PreferentialPrice;
                                self.submitForm.BuyBase = res.ReturnData.Data.BuyBase;
                                self.submitForm.TotalHours = res.ReturnData.Data.TotalHours;
                                self.submitForm.TeachingMethod = res.ReturnData.Data.TeachingMethod;
                                self.submitForm.IsPutaway = res.ReturnData.Data.IsPutaway;
                                //联动赋值
                                self.linkage.Discipline_OneLevelID = res.ReturnData.Data.Discipline_OneLevelID;
                                self.linkage.Discipline_TwoLevelID = res.ReturnData.Data.Discipline_TwoLevelID;
                                self.linkage.Discipline_ThreeLevelID = res.ReturnData.Data.Discipline_ThreeLevelID;
                            }
                        })
                    },
                    //添加修改网课
                    SaveCourse: function (params) {
                        var self = this;
                        $.ajax({
                            url: "/service/WebCourse/SaveCourse",
                            data: params,
                            method: "POST",
                            success: function (res) {
                                if (res.SuccessResponse) {
                                    layer.msg('保存成功')
                                    self.submitForm = res.ReturnData.Data;
                                } else {
                                    layer.msg(res.Message)
                                }
                            }
                        })
                    },
                    SecondBind: function (CID) {
                        return {
                            search: true,
                            fields: { key: 'ID', value: 'Name' },
                            options: [],
                            remote: { url: "", data: { CID: 0 } }
                        }
                    },
                    ThreeBind: function (CID) {
                        var data;
                        if (CID > 0) {
                            data = {
                                search: true,
                                fields: { key: 'ID', value: 'Name' },
                                options: [],
                                remote: { url: "", data: { CID: CID } }
                            }
                        } else {
                            data = {
                                search: true,
                                fields: { key: 'ID', value: 'Name' },
                                options: []
                            }
                        }
                        return data;
                    },
                    FirstChange: function () {
                        this.SecondSetting.remote.url = '/service/Discipline/GetDisciplineWithCID';
                        this.SecondSetting.remote.data = { CID: this.linkage.Discipline_OneLevelID };
                        fnr.mergeJson(this.SecondBind(this.linkage.Discipline_OneLevelID), this.SecondBind);
                        this.$refs.second.reset();
                    },
                    SecondChange: function () {
                        this.ThreeSetting.remote.url = '/service/Discipline/GetDisciplineWithCID';
                        this.ThreeSetting.remote.data = { CID: this.linkage.Discipline_TwoLevelID };
                        fnr.mergeJson(this.ThreeBind(this.linkage.Discipline_TwoLevelID), this.ThreeBind);
                        this.$refs.three.reset();
                    },
                    //保存
                    save: function (e) {
                        if (!layui.form.checkInput(e)) {
                            return false;
                        }
                        this.SaveCourse(this.submitForm)
                    },
                }
            });


        });
</script>