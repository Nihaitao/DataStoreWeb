<!DOCTYPE html>
<html lang="en">
<head>
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <meta charset="UTF-8">
    <title>专业筛选列表</title>
    <script src="../script/jquery.js"></script>
    <link rel="shortcut icon" href="" type="image/x-icon" class="favIcon" />
    <link href="../Resources/CSS/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../Resources/CSS/Font/css/font-awesome.min.css">
    <script src="../Resources/CSS/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../Resources/CSS/PC_css.css">
    <style>
        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body id="root" v-cloak>
    <div class="totalContaier">
        <!--#<!--#include file="UserControl/Header.html"-->
        <!--专业筛选-->
        <div class="Pro-screen">
            <div class="container">
                <div class="Pro-BreadcrumbNavigation">
                    <i class="icon_weizhi"></i>
                    <span>当前位置：</span>
                    <span>
                        <a href="/index.html">首页</a>
                    </span>
                    &gt;
                    <span>专业列表</span>
                </div>
                <div class="Pro-list" v-cloak>
                    <ul class="clearfix ProvinceList">
                        <li class="ProText">地区：</li>
                        <li class="active" @click="ProvinceClear">全部</li>
                        <li v-for="(index, item) in ProvinceData" @click="ClickProvince(item.ProvinceID)">
                            <a style="text-decoration: none;" href="javascript:;">{{item.ProvinceName}}</a>
                        </li>
                    </ul>
                    <ul class="clearfix LevelList">
                        <li class="LevText">层次：</li>
                        <li class="active" @click="LevelClear">全部</li>
                        <li v-for="(index, item) in LevelData" @click="ClickLeval(item.ID)">
                            <a style="text-decoration: none;" href="javascript:;">{{item.Description}}</a>
                        </li>
                    </ul>
                    <ul class="clearfix CategoryList" style="display: none;">
                        <li class="CatText">分类：</li>
                        <li class="active" @click="CategoryClear">全部</li>
                        <li v-for="(index, item) in CategoryData" @click="ClickCategory(item.ID)">
                            <a style="text-decoration: none;" href="javascript:;">{{item.Name}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!--显示列表-->
        <div class="Pro-showList">
            <div class="container">
                <!--<div class="Pro-chose">
                <a href="#" class="choseIndex active">最热</a>
                <a href="#" class="choseIndex">最新</a>
            </div>-->
                <div class="Pro-list clearfix" v-cloak style="margin-top: 30px;">
                    <div class="poC" v-if="rspListData.length > 0" v-for="(index, item) in rspListData">
                        <a style="text-decoration: none;" href="IntrList.shtml?id={{item.ID}}">
                            <img src="../Resources/images/picture.png" style="height: 127px;width: 224px">
                            <span class="p-text">{{item.Name}}</span>
                        </a>
                        <!--<div>
                        <div class="poA userNum"><i class="fa fa-user-o"></i> <span>{{item.Number}}</span>人</div>
                    </div>-->
                    </div>
                    <div class="poC" v-if="rspListData.length == 0">
                        <h4>暂无专业</h4>
                        <!--<div>
                        <div class="poA userNum"><i class="fa fa-user-o"></i> <span>{{item.Number}}</span>人</div>
                    </div>-->
                    </div>
                </div>
            </div>
        </div>
        <!--分页-->
        <div class="Pro-pageCount clearfix">
            <div class="clearfix" style="margin: 0 auto;width: 720px" id="pages"></div>
        </div>
    </div>
    <!--footer-->
    <!--#<!--#include file="/PublicControl/bottommenu.html"-->
    
</body>
</html>
<link href="https://bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/layer/css/layui.css" rel="stylesheet" />
<script src="https://bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/layer/layui.js"></script>
<script src="https://bbsresources.oss-cn-hangzhou.aliyuncs.com/js/modules/vue/vue.min.js"></script>
<script src="https://bbsresources.oss-cn-hangzhou.aliyuncs.com/js/require_config.js"></script>
<script src="../Resources/js/Page.js"></script>
<script>
    require_js_file(["table", "form", "jquery", "tableExt", 'wxconfig'], function (fnr) {
        function delAllCookie() {
            var myDate = new Date();
            myDate.setTime(-1000);//设置时间
            var data = document.cookie;
            var dataArray = data.split("; ");
            for (var i = 0; i < dataArray.length; i++) {
                var varName = dataArray[i].split("=");
                document.cookie = varName[0] + "=''; expires=" + myDate.toGMTString();
            }
        }
           var wxconfig = layui.wxconfig;
        window.rootApp = new Vue({
            el: '#root',
            data: {
                loginState: false,
                headPhoto: '',
                ProvinceId: 0,
                LevalId: 0,
                CategoryId: 0,
                ModelId: 1,
                PageIndex: 1,
                PageSize: 10,
                rspListData: [],
                ProvinceData: [],
                LevelData: [],
                CategoryData: [],
                layoutData: {},
                 userInfo: {}, //学生信息数据
            },
            ready: function () {
                this.userInfo = wxconfig.GetStudentInfo();
                this.requestList(this.ProvinceId, this.LevalId, this.CategoryId, this.ModelId, this.PageIndex, this.PageSize);
                this.ProvinceList();
                this.LevelList();
                this.CategoryList();
                this.checkLogin();

                var contaierHeight = $('.totalContaier').height();
                var windowScreenHeight = window.innerHeight;
                if(contaierHeight < windowScreenHeight){
                    $('.totalContaier').css('min-height', (windowScreenHeight - 160) + 'px');
                }
            },
            methods: {
                //退出
                exit: function () {
                    delAllCookie();
                    location.href = '../Login.shtml';
                },

                //查询stuID
                checkLogin: function () {
                    _this = this;
                    if (_this.userInfo.StuID && _this.userInfo.StuID != 'undefined') {
                        _this.loginState = true;
                        $.get("/service/edu/Student/GetStudentInfo", function (res) {
                            if (res.SuccessResponse) {
                                _this.msg = 'hi，' + res.Data.Name;
                                _this.headPhoto = res.Data.HeadImg ? res.Data.HeadImg : '../../Resources/images/photo.png'
                                _this.loginState = true;
                            }
                        });
                    }
                },

                //分页
                paging: function (pId, lId, cId, mId, pNum, sNum, totalPages) {
                    var self = this;
                    return $("#pages").Page({
                        pageIndex: pNum,
                        totalPages: Math.ceil(totalPages / 2),
                        totalSize: totalPages,
                        callback: function (num) {
                            self.rspListData = [];
                            self.requestList(pId, lId, cId, mId, num, sNum);
                        }
                    })
                },

                // 请求筛选列表参数
                // Province_ID省份ID，Level_ID层次ID，Category_ID专业分类ID，Model_ID模型ID，Orderstr排序字段，Order排序方式
                requestList: function (pId, lId, cId, mId, pNum, sNum) {
                    var self = this;
                    $.get('/service/edu/Specialty/GetSpecialtyList', { Province_ID: pId, Level_ID: lId, Category_ID: cId, Model_ID: mId, PageStatus: 1, PageIndex: pNum, PageSize: sNum }, function (rsp) {
                        if (rsp.SuccessResponse) {
                            if (rsp.Data) {
                                $.each(rsp.Data, function (k, v) {
                                    self.rspListData.push(v);
                                });
                            } else {
                                layer.msg('data为空')
                            }
                            self.paging(pId, lId, cId, mId, pNum, sNum, rsp.TotalCount);
                        } else {
                            layer.msg(rsp.Message ? rsp.Message : '操作失败')
                        }
                    });
                },

                //省份
                ProvinceList: function () {
                    var self = this;
                    $.get('/service/edu/Specialty/GetSpecialtyProvince', { Model_ID: 1 }, function (rsp) {
                        if (rsp.SuccessResponse) {
                            if (rsp.Data) {
                                $.each(rsp.Data, function (k, v) {
                                    self.ProvinceData.push(v);
                                });
                            } else {
                                layer.msg('data为空')
                            }
                        } else {
                            layer.msg(rsp.Message ? rsp.Message : '操作失败')
                        }
                    });
                },

                //层次
                LevelList: function () {
                    var self = this;
                    $.get('/service/public/HDictionary/GetHDictionaryList', {  Valid: 1, ColumnName: 'SpecialtyLevel_ID'  }, function (rsp) {
                        if (rsp.SuccessResponse) {
                            if (rsp.Data) {
                                $.each(rsp.Data, function (k, v) {
                                    self.LevelData.push(v);
                                });
                            } else {
                                layer.msg('data为空')
                            }
                        } else {
                            layer.msg(rsp.Message ? rsp.Message : '操作失败')
                        }
                    });
                },

                //分类
                CategoryList: function (Pid, Lid) {
                    var self = this;
                    if(Pid>0 && Lid>0){
                        $.get('/service/edu/Specialty/GetSpecialtyCategoryList', { Province_ID: Pid, Level_ID: Lid, Model_ID: 1, PageStatus: 0, PageIndex: 0, PageSize: 0 }, function (rsp) {
                            if (rsp.SuccessResponse) {
                                if (rsp.Data) {
                                    $.each(rsp.Data, function (k, v) {
                                        self.CategoryData.push(v);
                                    });
                                    if (self.CategoryData.length > 0) {
                                        $('.CategoryList').slideDown();
                                    } else {
                                        $('.CategoryList').slideUp();
                                    }
                                } else {
                                    layer.msg('data为空')
                                }
                            } else {
                                layer.msg(rsp.Message ? rsp.Message : '操作失败')
                            }
                        });
                    }else{

                        $('.CategoryList').slideUp();
                    }
                },

                //点击省份触发事件
                ClickProvince: function (pId) {
                    var self = this;
                    self.rspListData = [];
                    self.ProvinceId = pId;
                    if(self.ProvinceId == 0){
                        self.requestList(pId, self.LevalId, 0, self.ModelId, self.PageIndex, self.PageSize);
                        $('.ProvinceList').on('click', 'li:not(.ProText)', function () {
                            if (!$(this).hasClass('active')) {
                                $(this).find('a').css('color', '#fff');
                                $(this).addClass('active').siblings('li:not(.ProText)').removeClass('active').find('a').css('color', '#333');
                            }
                        });
                        self.CategoryData = [];
                        self.CategoryList(pId, self.LevalId);
                    }else{
                        self.requestList(pId, self.LevalId, self.CategoryId, self.ModelId, self.PageIndex, self.PageSize);
                        $('.ProvinceList').on('click', 'li:not(.ProText)', function () {
                            if (!$(this).hasClass('active')) {
                                $(this).find('a').css('color', '#fff');
                                $(this).addClass('active').siblings('li:not(.ProText)').removeClass('active').find('a').css('color', '#333');
                            }
                        });
                        self.CategoryData = [];
                        self.CategoryList(pId, self.LevalId);
                    }
                },

                //点击层次触发事件
                ClickLeval: function (lId) {
                    var self = this;
                    self.rspListData = [];
                    self.LevalId = lId;
                    if(self.LevalId == 0){
                        self.requestList(self.ProvinceId, lId, 0, self.ModelId, self.PageIndex, self.PageSize);
                        $('.LevelList').on('click', 'li:not(.LevText)', function () {
                            if (!$(this).hasClass('active')) {
                                $(this).find('a').css('color', '#fff');
                                $(this).addClass('active').siblings('li:not(.LevText)').removeClass('active').find('a').css('color', '#333');
                            }
                        });
                        self.CategoryData = [];
                        self.CategoryList(self.ProvinceId, lId);
                    }else{
                        self.requestList(self.ProvinceId, lId, self.CategoryId, self.ModelId, self.PageIndex, self.PageSize);
                        $('.LevelList').on('click', 'li:not(.LevText)', function () {
                            if (!$(this).hasClass('active')) {
                                $(this).find('a').css('color', '#fff');
                                $(this).addClass('active').siblings('li:not(.LevText)').removeClass('active').find('a').css('color', '#333');
                            }
                        });
                        self.CategoryData = [];
                        self.CategoryList(self.ProvinceId, lId);
                    }


                },

                //点击分类触发事件
                ClickCategory: function (cId) {
                    var self = this;
                    self.rspListData = [];
                    self.CategoryId = cId;
                    self.requestList(self.ProvinceId, self.LevalId, cId, self.ModelId, self.PageIndex, self.PageSize);
                    $('.CategoryList').on('click', 'li:not(.CatText)', function () {
                        if (!$(this).hasClass('active')) {
                            $(this).find('a').css('color', '#fff');
                            $(this).addClass('active').siblings('li:not(.CatText)').removeClass('active').find('a').css('color', '#333');
                        }
                    });
                },

                //`全部`按钮触发事件
                ProvinceClear: function () {
                    var self = this;
                    self.ClickProvince(0);
                    //self.CategoryClear();
                    if(!$('.CatText').next().hasClass('active')){$('.CatText').next().addClass('active')}
                },
                LevelClear: function () {
                    var self = this;
                    self.ClickLeval(0);
                    //self.CategoryClear();
                    if(!$('.CatText').next().hasClass('active')){$('.CatText').next().addClass('active')}
                },
                CategoryClear: function () {
                    var self = this;
                    self.ClickCategory(0);
                }
            }
        });
    });
</script>